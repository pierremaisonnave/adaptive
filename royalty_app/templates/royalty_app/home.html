{% extends "royalty_app/layout.html" %}
{% block content %}

  
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom" >
        <h1 class="h2">Dashboard </h1>
      </div>
      <div style="display:grid; grid-template-columns: 20px auto">
        <span  hidden class="bi-arrow-right-circle " id="unhide_cash_flow" onclick='unhide_table("cash_flow")'></span>
        <span  class="bi-arrow-down-circle " id="hide_cash_flow" onclick='hide_table("cash_flow")'></span>
        <h4 >Cash Flow Forecast ({{consolidation_currency}}) <span class="bi bi-arrow-repeat refresh" title="refresh" onclick="cash_forecast_change()" ></span></h4>
      </div>

      <div id="cash_flow">
        <div style="display:grid; grid-template-columns: 300px 150px 150px; ">
            <div  class="comboTreeWrapper" onchange="cash_forecast_change()" >
                <div  class="comboTreeInputWrapper" dd_id="currency">
                  <input style="background-color:transparent " type="text"  class="justAnInputBox comboTreeInputBox" placeholder="Select" readonly dd_id="currency"  value="currency_list" id="item_list_display_currency">
                  <input   type="text" hidden  id="item_list_currency" selection_mode="" value={{currency_list|join:"," }}> 
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_currency" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="currency">
                    <ul  >
                      <li class="selection_mode" >
                        <span class="mdi mdi-chevron-down-circle-outline" dd_id="currency"></span>
                        <ul >
                          <span class="select_all" id="select_mode_currency" style="font-weight: normal;font-family: arial; font-size: 0.800rem; color:#6c757d" onclick="selectall_forecast(this)">(unselect all)</span>
                        </ul>
                      {% for c in currency_list %}
                        <li   style="display: block;">
                          <input type="checkbox" style="margin-right:5px;"  dd_id="currency" checked><span >{{c}}</span><span>    </span><span></span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              </div>
              <select id="item_list_year_forecast" onchange="cash_forecast_change()" style="margin-left:10px">
              {% for y in year_list_cash_forecast %}
                {% if y == current_year %}
                  <option value={{y}} selected="selected">{{y}}</option>
                  {% else %}
                  <option value={{y}}>{{y}}</option>
                {% endif %}
              {% endfor %}
              </select>
              <select id="list_report" onchange="cash_forecast_change()" style="margin-left:10px">
              {% for r in CFF_report_list %}
                {% if r.id == CFF_report_id %}
                  <option value={{r.id}} selected="selected">{{r.name}}</option>
                  {% else %}
                  <option value={{r.id}}>{{r.name}}</option>
                {% endif %}
              {% endfor %}
              </select>
        </div>
        <div>Total amount : {{consolidation_currency}}<span id="total_amount">{{total_amount|default_if_none:""}}</span> Mi.</div>
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap" style="width:80%">
          <div  style=" width: 300px;height: 300px">
            <canvas id="pie_contract" ></canvas>
          </div>
          <div  style=" width: 300px;height: 300px">
            <canvas id="pie_country" ></canvas>
          </div>
          <div  style=" width: 300px;height: 300px">
            <canvas id="pie_currency" ></canvas>
          </div>
        </div>
        
        <div  style="width:95%; height: 400px;">
          <canvas id="myChart2" style="height:300px"></canvas>
        </div>
      </div>

      <div style="display:grid; grid-template-columns: 20px auto">
        <span  hidden class="bi-arrow-right-circle " id="unhide_accruals" onclick='unhide_table("accruals")'></span>
        <span  class="bi-arrow-down-circle " id="hide_accruals" onclick='hide_table("accruals")'></span>
        <h4 >Accruals Summary ({{consolidation_currency}}) <span class="bi bi-arrow-repeat refresh" title="refresh" onclick="accruals_change()" ></span></h4>
      </div>

      <div id="accruals">  
        <div style="display:grid; grid-template-columns: 300px 150px; ">
          <div  class="comboTreeWrapper" onchange="accruals_change()" >
              <div  class="comboTreeInputWrapper" dd_id="contract">
                <input style="background-color:transparent " type="text"  class="justAnInputBox comboTreeInputBox" placeholder="Select" readonly dd_id="contract"  value="Contract_list" id="item_list_display_contract">
                <input   type="text" hidden  id="item_list_contract" selection_mode="" value={{contract_id_list|join:"," }}> 
              </div>
              <div  class="comboTreeDropDownContainer" id="dropdown_contract" style="display: none;">
                <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="contract">
                  <ul  >
                    <li class="selection_mode" >
                      <span class="mdi mdi-chevron-down-circle-outline" dd_id="contract"></span>
                      <ul >
                        <span class="select_all" id="select_mode_contract" style="font-weight: normal;font-family: arial; font-size: 0.800rem; color:#6c757d" onclick="selectall(this)">(unselect all)</span>
                      </ul>
                    {% for c in contract_list %}
                      <li   style="display: block;">
                        <input type="checkbox" style="margin-right:5px;"  dd_id="contract" checked><span hidden>{{c.id}}</span><span> {{c.id}}: </span><span>{{c.contract_name}}</span>
                      </li>
                    {% endfor %}
                  </ul>
              </div>
            </div>

          <select id="item_list_year" onchange="accruals_change()" style="margin-left:10px">
            {% for y in year_list %}
              {% if y == current_year %}
                <option value={{y}} selected="selected">{{y}}</option>
                {% else %}
                <option value={{y}}>{{y}}</option>
              {% endif %}
            {% endfor %}
            </select>
        </div>
        <div style="width:95%; height: 400px;">
          <canvas id="myChart" ></canvas>
        </div>
      </div>









  <!------------------------------------------------------------------------------------->   
  <!---------------------------Form for new Contracts------------------------------------> 



  


{% load static %}
<script>

var pie_contract_elm = document.getElementById('pie_contract');
var pie_contract = new Chart(pie_contract_elm, {
    type: 'pie',
    data: {
      labels: {{labels_contract|safe}},
      datasets: [{
        data: {{data_contract|safe}},
        label: 'Contract',
        backgroundColor: {{color_contract|safe}},
      }]
    },
    plugins:[ChartDataLabels],
    options: {
      responsive: true,
      plugins: {
        legend: {
          display:false,
        },
        title: {
          display: true,
          text: 'Breakdown per contract'
        },
        datalabels: {
          formatter: function(value, context) {
            return context.chart.data.labels[context.dataIndex]+'\n'+Math.round(value/10000,2)/100+'Mi.';
          },
          font: {size: 12}
        }       

      }
    },
    


});
var pie_currency_elm = document.getElementById('pie_currency');
var pie_currency = new Chart(pie_currency_elm, {
    type: 'pie',
    data: {
      labels: {{labels_currency|safe}},
      datasets: [{
        data: {{data_currency|safe}},
        label: 'Contract',
        backgroundColor: {{color_currency|safe}},
      }]
    },
    plugins:[ChartDataLabels],
    options: {
      responsive: true,
      plugins: {
        legend: {
          display:false,
        },
        title: {
          display: true,
          text: 'Breakdown per currency'
        },
        datalabels: {
          formatter: function(value, context) {
            return context.chart.data.labels[context.dataIndex]+'\n'+Math.round(value/10000,2)/100+'Mi.';
          },
          font: {size: 20}
        }   
      }
    },

});
var pie_country_elm = document.getElementById('pie_country');

var pie_country = new Chart(pie_country_elm, {
    type: 'pie',
    data: {
      labels: {{labels_country|safe}},
      datasets: [{
        data: {{data_country|safe}},
        label: 'Contract',
        backgroundColor: {{color_country|safe}},
      }]
    },
    plugins:[ChartDataLabels],
    options: {
      responsive: true,
      plugins: {
        legend: {
          
          display:false,
          position: 'left',
          labels: {
            boxWidth:20,
            boxHeight:10,
            font: {
              size: 10
            }
          }
        },
        title: {
          display: true,
          text: 'Breakdown per country'
        },
        datalabels: {
          formatter: function(value, context) {
            return context.chart.data.labels[context.dataIndex];
          },
          font: {size: 12}
        }  
      }
    },

});


var ctx2 = document.getElementById('myChart2');

var myChart2 = new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: {{ labels_cash_forecast|safe }},
        datasets: [

          {
            label: 'CFF',
            data: {{data_cash_forecast|safe}},
            backgroundColor:'rgba(54, 162, 235, 0.5)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          },
          {
            label: 'CFF Y-1',
            data: {{data_cash_forecast_last_year|safe}},
            backgroundColor:'rgba(54, 162, 235, 0.1)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(54, 162, 235, .2)',
            borderWidth: 1,
            hidden: true,
          },

        ]
    },
    plugins:[ChartDataLabels],
    options: {
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        },
        plugins:{
          datalabels: {
            formatter: function(value, context) {
              if(value==0){return ""}else{return Math.round(value/10000,2)/100 +'Mi.'};
            },
            font: {size: 12}
          }  
        }
    }
});

var ctx = document.getElementById('myChart');

var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ labels|safe }},
        datasets: [
        {
            label: 'Accruals',
            data: {{data_accruals|safe}},
            backgroundColor:'rgba(255, 99, 132, 0.5)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
          },
        {
            label: 'Accruals Y-1',
            data: {{data_accruals_last_year|safe}},
            backgroundColor:'rgba(255, 99, 132, 0.1)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(255, 99, 132, .2)',
            borderWidth: 1,
            hidden: true,
          },
          {
            label: 'Roy_Ytd',
            data: {{data_roy_ytd|safe}},
            backgroundColor:'rgba(54, 162, 235, 0.5)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            hidden: true,
          },
          {
            label: 'Roy_Ytd Y-1',
            data: {{data_roy_ytd_last_year|safe}},
            backgroundColor:'rgba(54, 162, 235, 0.1)',// red bg 'rgba(255, 99, 132, 0.2)' red border 'rgba(255, 99, 132, 1)'  
            borderColor: 'rgba(54, 162, 235, .2)',
            borderWidth: 1,
            hidden: true,
          },



        ]
    },
    plugins:[ChartDataLabels],
    options: {
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        },
        plugins:{
          datalabels: {
            formatter: function(value, context) {
              if(value==0){return ""}else{return Math.round(value/10000,2)/100 +'Mi.'};
            },
            font: {size: 12}
          }  
        }
    }
});




</script>
    <script src="{% static 'royalty_app/home.js'%}"></script>
    <link rel="stylesheet" href="{% static 'royalty_app/style.css'%}">
    <script src="{% static 'royalty_app/dropdown_multiple.js'%}"></script>



 

{% endblock %}

