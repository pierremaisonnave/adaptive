{% extends "royalty_app/layout.html" %}
{% block content %}



      <div class=" pb-2 mb-3 border-bottom" style="display: flex" >
         <h1 class="h2">Contracts </h1>
         <a  style="padding-top:16px" href="{% url 'contracts_current' %}"  onclick="spinner()">(click here to see the contracts currently used in the system)<a>
   
      </div>

  
  <!------------------------------------------------------------------------------------->   
  <!---------------------------Form for new Contracts------------------------------------> 

    <form   id="form_new" > 
      <table>
        <tr>
          <td style="width: 210px">
            <span style="width: 100%; margin-left:5px;">New Contract:</span>
          </td>
        </tr>
        <tr>

          <td>
            <!--contract-type-->
            <div style="width: 100%; margin-left:5px;" class="comboTreeWrapper">
              {% if type_list %}
                <div  class="comboTreeInputWrapper" dd_id="type_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Type" readonly dd_id="type_new" id="displayed_item_name_type_new" >
                  <input type="text"    class="comboTreeHiddenBox" hidden id="hidden_item_code_type_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_type_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" style="width:100%" placeholder="Type to filter" dd_id="type_new" style="width: 100%;">
                    <ul  >
                      {% for type in type_list %}
                        <li style="display: block;" class="item_single_select" dd_id="type_new" item_code="{{ type.id }}" item_display="{{ type.name }}">
                          <span >{{ type.name }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="Type: Empty"  style="width:100%" title="please insert Divisions in static data tab" id="displayed_item_name_type_new">
                <input type="text"   hidden id="hidden_item_code_type_new">
              {% endif %}
            </div>

          </td>
          <td > <!--Name-->
            <input type="text" id="contract_name_new" placeholder="Contract Name"  maxlength="50" style="width: 100%; margin-left:5px;">
          </td>

          <td>
            <!--Gald Div list-->
            <div style="width: 100%; margin-left:5px;"class="comboTreeWrapper">
              {% if division_list %}
                <div  class="comboTreeInputWrapper" dd_id="division_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Division" readonly dd_id="division_new" id="displayed_item_name_division_new" >
                  <input type="text"    class="comboTreeHiddenBox" hidden id="hidden_item_code_division_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_division_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="division_new" style="width: 100%;">
                    <ul  >
                      {% for division in division_list %}
                        <li style="display: block;" class="item_single_select" dd_id="division_new" item_code="{{ division.division_id }}" item_display="{{ division.division_name }}">
                          <span >{{ division.division_id }}:{{ division.division_name }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="Division: Empty"  style="width:100%" title="please insert Divisions in static data tab" id="displayed_item_name_division_new">
                <input type="text"   hidden id="hidden_item_code_division_new">
                {% endif %}
            </div>

          </td>
          <td style="display: None;"> 
            <!-- Div via-->
            <div style="width: 100%; margin-left:5px; "class="comboTreeWrapper">
              {% if division_list %}
                <div  class="comboTreeInputWrapper" dd_id="division_via_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="pass-through division" readonly dd_id="division_via_new" id="displayed_item_name_division_via_new" >
                  <input type="text"   hidden id="hidden_item_code_division_via_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_division_via_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="division_via_new" >
                    <ul  >
                      <li style="display: block;" class="item_single_select" dd_id="division_via_new" >
                        <span></span><span style="color:white"> : </span><span></span>
                      </li>
                      {% for division in division_list %}
                        <li style="display: block;" class="item_single_select" dd_id="division_via_new">
                          <span >{{ division.division_id }}</span><span > : </span><span>{{ division.division_name }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
                {% else %}
                  <input type="text"   hidden id="hidden_item_code_division_via_new">
                  <input type="text" readonly placeholder="pass-through division: Empty"  style="width:100%" title="please insert pass-through division in static data tab" id="displayed_item_name_division_via_new">
                {% endif %}
            </div>
          </td>
          <td ><!--pay/REC-->
            <div style="width: 100%; margin-left:5px;">
              <select  style="width: 100% ; padding:2px" id="transaction_direction_new" >
                <option value="PAY"> PAY</option>
                <option value="REC"> REC</option>
              </select>
            </div>
          </td>

        </tr>
        <tr>
          <td>
            <!--Currency-->
            <div style="width: 100%; margin-left:5px;"class="comboTreeWrapper">
              {% if currency_list %}
                <div  class="comboTreeInputWrapper" dd_id="contract_currency_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Currency" readonly dd_id="contract_currency_new" id="displayed_item_name_contract_currency_new" >
                  <input type="text"    class="comboTreeHiddenBox" hidden id="hidden_item_code_contract_currency_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_contract_currency_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="contract_currency_new" style="width: 100%;">
                    <ul  >
                      {% for currency in currency_list %}
                        <li style="display: block;" class="item_single_select" dd_id="contract_currency_new" item_code="{{ currency.currency }}" item_display="{{ currency.currency }}">
                          <span >{{ currency.currency }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="currency: Empty"  style="width:100%" title="please insert currencies in static data tab" id="displayed_item_name_contract_currency_new">
                <input type="text"   hidden id="hidden_item_code_contract_currency_new">
              {% endif %}
            </div>

          </td>
          
          <td>
            <!--periodicity-->
            <div style="width: 100%; margin-left:5px;"class="comboTreeWrapper">
              {% if periodicity_list %}
                <div  class="comboTreeInputWrapper" dd_id="periodicity_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Periodicity" readonly dd_id="periodicity_new" id="displayed_item_name_periodicity_new" >
                  <input type="text"   class="comboTreeHiddenBox" hidden id="hidden_item_code_periodicity_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_periodicity_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="periodicity_new" style="width: 100%;" >
                    <ul  >
                      {% for periodicity in periodicity_list %}
                        <li style="display: block;" class="item_single_select" dd_id="periodicity_new" item_code="{{ periodicity.id }}" item_display="{{ periodicity.periodicity }}">
                          <span >{{ periodicity.periodicity }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="Periodicity: Empty"  style="width:100%" title="please insert periodicity in static data tab" id="displayed_item_name_periodicity_new" >
                <input type="text"   hidden id="hidden_item_code_periodicity_new">
              {% endif %}
            </div>    
          </td>

          <td ><!--payment terms-->
            <input id="payment_terms_new" placeholder="nb days-payment terms"  type="number" min="0"  style="width: 100%; margin-left:5px;">
          </td>
          <td>
            <!--M3 Brand list-->
            <div style="width: 100%; margin-left:5px;"class="comboTreeWrapper">
              {% if m3_brand_list %}
                <div  class="comboTreeInputWrapper" dd_id="m3_brand_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Brand Code" readonly dd_id="m3_brand_new" id="displayed_item_name_m3_brand_new" >
                  <input type="text"   class="comboTreeHiddenBox" hidden id="hidden_item_code_m3_brand_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_m3_brand_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="m3_brand_new" style="width: 100%;">
                    <ul  >
                      {% for brand in m3_brand_list %}
                        <li style="display: block;" class="item_single_select" dd_id="m3_brand_new" item_code="{{ brand.id }}" item_display="{{ brand.brand_name }}">
                          <span>{{ brand.brand_name }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="Brand: Empty"  style="width:100%" title="please insert brands in static data tab" id="displayed_item_name_m3_brand_new" >
                <input type="text"   hidden id="hidden_item_code_m3_brand_new">
              {% endif %}
            </div>
          </td>
        </tr>
        <tr>
          <td ><!--mini gar status-->
            <div   style="width: 100%; margin-left:5px;">
              <select  style="width: 100%; padding:2px"  id="mini_gar_status_new" onchange="hide_option()" >
                <option value="YES"> minimum amount/year : YES</option>
                <option value="NO" selected>  minimum amount/year : NO</option>
              </select>
            </div>
          </td>
          <td class="mini_gar_option" hidden><!--amount-->
            <input class="number-separator" id="minimum_guar_amount_new" placeholder="amount"  type="text"  style="width: 100%; margin-left:5px;">
          </td>
          <!--Country List-->
          <td  class="comboTreeWrapper mini_gar_option" hidden>
            <div style="width: 100%; margin-left:5px;" class="comboTreeWrapper">
              {% if country_list %}
                <div  class="comboTreeInputWrapper" dd_id="country_new">
                  <input type="text"   class="justAnInputBox comboTreeInputBox" placeholder="Country" readonly dd_id="country_new" id="displayed_item_name_country_new" >
                  <input type="text"   class="comboTreeHiddenBox" hidden id="hidden_item_code_country_new">
                </div>
                <div  class="comboTreeDropDownContainer" id="dropdown_country_new" style="display: none;">
                  <input  type="text" class="multiplesFilter" placeholder="Type to filter" dd_id="country_new" style="width: 100%;" >
                    <ul  >
                      <li style="display: block;" class="item_single_select" dd_id="country_new" >
                        <span></span><span style="color:white"> : </span><span></span>
                      </li> 
                    {% for region in region_list %} 
                      <li  >
                        <span class="bi-arrow-down-circle comboTreeParentPlus" dd_id="country_new" group_id={{region.id}} ></span>
                        <span  dd_id="country_new">{{region.region}}</span>
                        <ul style="display: block;" id="country_new_{{region.id}}">
                          {% for country in country_list %}
                            {% if region == country.country_region%}
                              <li style="display: block;" class="item_single_select" dd_id="country_new" item_code="{{ country.country_id }}" item_display="{{ country.country }}">
                                <span>{{ country.country_id }} : {{ country.country }}</span>
                              </li>
                              {% endif %}
                          {% endfor %}
                        </ul>
                      </li>
                    {% endfor %}
                      
                    </ul>
                </div>
              {% else %}
                <input type="text" readonly placeholder="Countries: Empty"  style="width:100%" title="please insert Countries in static data tab" id="displayed_item_name_country_new">
                <input type="text"   hidden id="hidden_item_code_country_new">
              {% endif %}
            </div>
          </td>
        </tr>


      
        <tr > <!--last row-->
          <td colspan="3">
            <div style="width: 100%; margin-left:5px;">
              <div id="message_save" style="color: green;" hidden > Item saved</div>
              <div id="message_error" style="color: red;" hidden > error: some fields are missing</div>
          </div>
          </td>
          <td style="  float: right;display:grid;grid-template-columns: 35px  35px">
            <div style="margin-right: 3px">
              <button class="btn btn-sm btn-outline-success" type="button" onclick="add_new_record()" title="save" id="saved_button_contract" style="display: Block;"><span class="bi bi-save2-fill"></span></button>
              <div id="spinner_contract" style="display: None; padding-top: 6px;padding-left: 4px">
                <div class="sk-chase" >
                  <div class="sk-chase-dot"></div>
                  <div class="sk-chase-dot"></div>
                  <div class="sk-chase-dot"></div>
                  <div class="sk-chase-dot"></div>
                  <div class="sk-chase-dot"></div>
                  <div class="sk-chase-dot"></div>
                </div>
              </div>
              <div style="text-align: end; color:green ;display: None;    position: relative; right: 10px ;top:5px" id="saved_message_contract" >Saved</div>
            </div>
            <button class="btn btn-sm btn-outline-warning"  onclick="cancel_new_record()" type="reset" title="cancel"> <span class="bi bi-x-circle"></span></button>
          </td>
        </tr>
      </table> 

    </form>

  <!------------------------------------------------------------------------------------->   
  <!---------------------------Contracts Table------------------------------------------->  
  
  <!----setting to unhide/hide column--->  
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom" >
    <div></div>
    <div class="btn-toolbar mb-2 mb-md-0">
      <div class="btn-group mr-2">
        <button class="btn btn-sm btn-outline-secondary" type="button" onclick="column_sel()" title="column selection" ><span class="bi bi-gear"></span> </button>
      </div>
      <div class="btn-group mr-2">
        <a class="btn btn-sm btn-outline-secondary" href="/export/contract,contract_partner,rule" ><span class="bi bi-download" ></span> download </a>
      </div>

    </div>
  </div> 
  <div id="column_selection" style=" display:none" >
    <table class="table table-striped table-sm" id="beneficiary_table" >
      <thead>
        <tr >
          <th  > </th>
          <th ></th>
        </tr>
      </thead>
      <tbody>

        <tr >
          <td ><input type="checkbox" checked value=1 onclick="column_visibility(this,1)"></td>
          <td >Type</td>

          <td ><input type="checkbox" checked value=2 onclick="column_visibility(this,2)"></td>
          <td >Name</td>

          <td ><input type="checkbox" checked value=3 onclick="column_visibility(this,3)"></td>
          <td >Division</td>

          <td ><input type="checkbox" checked value=4 onclick="column_visibility(this,4)"></td>
          <td >Pay/Rec</td>

        </tr>
        <tr >
          <td ><input type="checkbox" checked value=5 onclick="column_visibility(this,5)"></td>
          <td >Curr</td>

          <td ><input type="checkbox" checked value=6 onclick="column_visibility(this,6)"></td>
          <td >periodicity</td>

          <td ><input type="checkbox" checked value=7 onclick="column_visibility(this,7)"></td>
          <td >payment terms:nb days</td>

          <td ><input type="checkbox" checked value=8 onclick="column_visibility(this,8)"></td>
          <td >Brand</td>


        </tr>
        <tr >


          <td ><input type="checkbox"   value=10 onclick="column_visibility(this,10)"></td>
          <td >Minimum Guarantee:Yes/No</td>

          <td ><input type="checkbox"   value=11 onclick="column_visibility(this,11)"></td>
          <td >Minimum Guarantee:Amount</td>

          <td ><input type="checkbox"   value=12 onclick="column_visibility(this,12)"></td>
          <td >Minimum Guarantee:Country</td>
          <td ><input style="display: None;" type="checkbox"  value=9 onclick="column_visibility(this,9)"></td>
          <td ><span style="display: None;">Division via</span></td>
        </tr>
        
      </tbody>
    </table>
  </div>  


  <div class="table-responsive">
    <table class="table table-striped table-sm " id="contracts_table" style="width: 100%;">
      <thead>
        <tr class="search_box_class">
          <th style="padding-left:8px"><input  id="column0_search"  class="fname2" placeholder="..." column=0> </th>
          <th style="padding-left:8px"><input  id="column1_search"  class="fname2" placeholder="..." column=1> </th>
          <th style="padding-left:8px"><input  id="column2_search"  class="fname2" placeholder="..." column=2>  </th>
          <th style="padding-left:8px"><input  id="column3_search"  class="fname2" placeholder="..." column=3> </th>
          <th style="padding-left:8px"><input  id="column4_search"  class="fname2" placeholder="..." column=4> </th>
          <th style="padding-left:8px"><input  id="column5_search"  class="fname2" placeholder="..." column=5> </th>
          <th style="padding-left:8px"><input  id="column6_search"  class="fname2" placeholder="..." column=6> </th>
          <th style="padding-left:8px"><input  id="column7_search"  class="fname2" placeholder="..." column=7> </th>
          <th style="padding-left:8px"><input  id="column8_search"  class="fname2" placeholder="..." column=8> </th>
          <th style="padding-left:8px"><input  id="column9_search"  class="fname2" placeholder="..." column=9> </th>
          <th style="padding-left:8px"><input  id="column10_search"  class="fname2" placeholder="..." column=10> </th>
          <th style="padding-left:8px" ><input  id="column11_search"  class="fname2" placeholder="..." column=11 > </th>
          <th style="padding-left:8px"><input  id="column12_search"  class="fname2" placeholder="..." column=12 > </th>
          <th style="padding-left:8px"><input  id="column13_search"  class="fname2" placeholder="..." column=13 > </th>
        </tr>
        <tr >
          <th style="border-bottom:none" colspan=10></th>
          <th colspan=3 style="text-align: center;border-bottom:none; padding:2px">Minimum Guarantee</th>
          <th style="border-bottom:none"></th>
        </tr>        
        <tr style="height:65px">
          <th style="border-top:none; padding-left: 8px; width:20px">ID</th>
          <th style="border-top:none; padding-left: 8px">Type</th>
          <th style="border-top:none; padding-left: 8px">Name</th>
          <th style="border-top:none; padding-left: 8px;width:50px;">Division</th>
          <th style="border-top:none; padding-left: 8px;width:50px;">Pay/Rec</th>
          <th style="border-top:none; padding-left: 8px;width:50px;">Curr</th>
          <th style="border-top:none; padding-left: 8px;">periodicity</th>
          <th style="border-top:none; padding-left: 8px;width:70px;">nb days</th>
          <th style="border-top:none; padding-left: 8px;">Brand</th>
          <th style="border-top:none; padding-left: 8px;width:50px;">via</th>
          <th style="border-top:none; padding-left: 8px;width:50px;">Yes/No</th>
          <th style="border-top:none; padding-left: 8px;">Amount</th>
          <th style="border-top:none; padding-left: 8px;width:50px;" >Country</th>
          <th style="border-top:none"></th>
        </tr>
      </thead>

      <tbody id="tbody_contracts">
        {% for contract in contract_list %}
          <tr>
            <td><!--ID-->
              <a href="{% url 'rules' contract_id=contract.id %}"  onclick="spinner()"><span class="fname" contract_id={{contract.id}} id="id_{{contract.id}}" >{{contract.id}}</span></a>
            </td>
            <td><!--Type-->
              <span >{{contract.contract_type}}</span>
            </td>
            <td><!--Name-->
              <span >{{contract.contract_name}}</span>
            </td>
            <td><!--Division-->
              <span >{{contract.division.division_id}}</span>
            </td>
            <td><!--pay/rec-->
              <span >{{contract.transaction_direction}}</span>
            </td>

            <td><!--Currency-->
              <span  >{{contract.contract_currency}}</span>
            </td>

            <td><!--Periodicity-->
              <span  >{{contract.payment_periodicity.periodicity}}</span>
            </td>

            <td> <!--payment_terms-->
              <span  >{{contract.payment_terms}}</span>
            </td>
            <td> <!--payment_terms-->
              <span  >{{contract.m3_brand.brand_name}}</span>
            </td>

            <td><!--Division via-->
              <span >{{contract.division_via.division_id}}</span>
            </td>

            <td><!--yes/no mini gar-->
              <span >{{contract.mini_gar_status}}</span>
            </td>
            <td><!--Amount-->
              <span >{{contract.minimum_guar_amount|default_if_none:""}}</span>
            </td>
            <td><!--Country-->
              <span >{{contract.minimum_guar_remaining_allocation_country.country_id}} </span>
            </td>
            <td><!--Button-->
              {% if contract.status == "IN_CREATION" %} 
                <span style="color:orange"> {{contract.status}}, not submitted for validation</span>
              {% elif contract.status == "CURRENT" %}
              
              {% else %}
                <span style="color:orange"> {{contract.status}} pending validation</span>

              {%endif%}
            </td>
          </tr>
        {% endfor %}
      </tbody>    
      
    </table>
  </div>

  


{% load static %}
  
    <link rel="stylesheet" href="{% static 'royalty_app/style.css'%}">
    <script src="{% static 'royalty_app/contracts/contract.js'%}"></script>
    <script src="{% static 'royalty_app/easy-number-separator.js'%}"></script>



 

{% endblock %}

